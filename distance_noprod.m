function [D,W,error,simulated_data] = distance_noprod(X, cf_num, seed)
% This function takes a set of parameters and returns the distance between
% the moments in the data and the moments generated by the parameter set.


    % Long format for printing
    format long;

    % Reset random number generator
    if seed == 1
        rng(80085);
    end
    
    % Start timer
    tic
    
    % Change X vector into parameter names
    X2params;

    % Get policy functions
    make_policy;

    % Reset random number generator
    if seed == 1
        rng(80085);
    end

    % Simulate model and create loss function statistics
    [simulated_data,mavship,loglog_coefs,exp_dom_coefs,dom_ar1_coefs,cli_coefs,exp_death_coefs,match_death_coefs,exp_sales_coefs,match_ar1_coefs] = moms_nocell(mm,lambda_f_orig,lambda_h_orig,lambda_f_new,lambda_h_new,c_val_h_orig,c_val_f_orig,c_val_h_new,c_val_f_new,cf_num,increase,seed);
    
    %% Targets
    [Data, W] = target_stats();
    % to use diagonal of W, uncomment next command
    % W = diag(diag(W));

    %% Simulated data 
    Model = cat(1,cli_coefs,exp_death_coefs,match_death_coefs,exp_sales_coefs,match_ar1_coefs,loglog_coefs,mavship,exp_dom_coefs,dom_ar1_coefs);

    % Construct loss
    try
    
        error = Data'-Model;
        %W = eye(size(error,1)); %remove weights
        D = error'*(W^-1)*error;
        % D = norm(error)/norm(Data)
    
        % Check for NaNs
        nanflag = isnan(D); 
        if nanflag>0;
            D = D * 10; 
        end
    
        % Punish for value function non-convergence
        punishment;
        D = D*(1+punishment);
        
        % Print Diagnostics
        mmm = cat(2,Data',Model) %data/model comparison
        X %print out current parameter guess
        D %loss
    
        %Simple unweighted loss
        Old_D = norm(error)/norm(Data')
        
        % replace weighted fit metric with old fit metric for test run 
        % D = Old_D
    
        %Print loop time in minutes
        last_loop_run_time = toc/60
    
    catch err

        % report error
        getReport(err, 'extended')
    
        % If broken for any reason, return high loss
        D = 1e12;
    
    end %end try/catch

    % Write current results to file
    fileID = fopen('results/running_output.txt','a');
    fprintf(fileID, '\n moments = \n');
    dlmwrite('results/running_output.txt',mmm,'-append','precision',12);
    fprintf(fileID, '\n params = \n');
    dlmwrite('results/running_output.txt',X,'-append','precision',12);
    fprintf(fileID, '\n fit = \n');
    dlmwrite('results/running_output.txt',D,'-append','precision',12);
    fclose(fileID);

    % Free up memory
    clearvars -except D W error simulated_data
    % java.lang.Runtime.getRuntime.gc; %java garbage collector

end %end function
